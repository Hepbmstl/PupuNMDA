<UserControl x:Class="NeuronCAD.Visuals.Tabs.Modeling.ModelingPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:helix="http://helix-toolkit.org/wpf"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000">
    
    <Grid Background="#1E1E1E">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 左侧 Panels -->
        <Border Grid.Column="0" Background="#252526" BorderBrush="#3F3F46" BorderThickness="0,0,1,0">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="Properties Panel" Foreground="#888888" FontSize="16" HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- 右侧 Modeling 区域 -->
        <Grid Grid.Column="1" ClipToBounds="True">
            
            <!-- 1. 3D 视口 -->
            <helix:HelixViewport3D x:Name="MainViewport"
                                   ShowCoordinateSystem="True"
                                   CoordinateSystemLabelForeground="White"
                                   ZoomExtentsWhenLoaded="True"
                                   ShowViewCube="True"
                                   MouseDown="OnViewportMouseDown"
                                   MouseMove="OnViewportMouseMove"
                                   MouseUp="OnViewportMouseUp"
                                   MouseWheel="OnViewportMouseWheel">
            </helix:HelixViewport3D>

            <!-- 2. UI 覆盖层 (Overlay) -->
            <Canvas x:Name="OverlayCanvas" IsHitTestVisible="False">
                
                <!-- 十字准星 (Crosshair) -->
                <Path x:Name="CrosshairPath" Stroke="#88FFFFFF" StrokeThickness="1" SnapsToDevicePixels="True">
                    <Path.Data>
                        <GeometryGroup>
                            <LineGeometry StartPoint="-10,0" EndPoint="10,0"/>
                            <LineGeometry StartPoint="0,-10" EndPoint="0,10"/>
                        </GeometryGroup>
                    </Path.Data>
                </Path>

                <!-- 坐标 HUD (跟随鼠标) -->
                <Border x:Name="CoordHud" Background="#CC000000" CornerRadius="4" Padding="5,2" Canvas.Left="0" Canvas.Top="0">
                    <TextBlock x:Name="CoordText" Text="X:0 Y:0 Z:0" Foreground="#00FF00" FontFamily="Consolas" FontSize="12"/>
                </Border>
            </Canvas>

            <!-- 3. 尺寸修改弹窗 (Edit Popup) - 默认隐藏 -->
            <!-- IsHitTestVisible="True" 允许输入 -->
            <Grid x:Name="EditPopup" Visibility="Collapsed" HorizontalAlignment="Left" VerticalAlignment="Top" Width="220">
                <Border Background="#DD333333" BorderBrush="#555" BorderThickness="1" CornerRadius="8" Padding="10">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.5"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="Edit Dimensions" Foreground="White" FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <!-- 圆柱体: 长度 -->
                        <StackPanel x:Name="PanelAxonLength" Visibility="Collapsed" Margin="0,0,0,5">
                            <TextBlock Text="Length:" Foreground="#CCC" FontSize="11"/>
                            <TextBox x:Name="TbLength" Background="#222" Foreground="White" BorderBrush="#555"/>
                        </StackPanel>

                        <!-- 通用: 半径 -->
                        <StackPanel x:Name="PanelRadius" Visibility="Collapsed" Margin="0,0,0,10">
                            <TextBlock Text="Radius:" Foreground="#CCC" FontSize="11"/>
                            <TextBox x:Name="TbRadius" Background="#222" Foreground="White" BorderBrush="#555"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Cancel" Click="OnCancelEdit" Width="60" Margin="0,0,5,0" Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"/>
                            <Button Content="Apply" Click="OnApplyEdit" Width="60" Background="#007ACC" Foreground="White"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- 4. 底部工具栏 -->
            <Border VerticalAlignment="Bottom" HorizontalAlignment="Center" 
                    Background="#CC333333" CornerRadius="8" Padding="10" Margin="0,0,0,20">
                <StackPanel Orientation="Horizontal">
                    <Button Content="Add Soma" Click="OnAddSomaClick" Padding="10,5" Margin="5"/>
                    <Button Content="Add Axon" Click="OnAddAxonClick" Padding="10,5" Margin="5"/>
                </StackPanel>
            </Border>
            
        </Grid>
    </Grid>
</UserControl>